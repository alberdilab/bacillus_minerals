[["index.html", "AlberdiLab | Carbajo et al. 2026 Study in progress Chapter 1 Introduction 1.1 Prepare the R environment", " AlberdiLab | Carbajo et al. 2026 Study in progress Carlota Carbajo, Nanna Gaun, Antton Alberdi1, Karina Sand Last update: 2026-02-08 Chapter 1 Introduction This webbook contains all the code used for data analysis in study of gut microbiomes of newts across ponds included in a restoration plan. 1.1 Prepare the R environment 1.1.1 Environment To reproduce all the analyses locally, clone this repository in your computer using: RStudio &gt; New Project &gt; Version Control &gt; Git And indicating the following git repository: https://github.com/alberdilab/bacillus_minerals.git Once the R project has been created, follow the instructions and code chunks shown in this webbook. 1.1.2 Libraries Install this packages if needed ## Bioconductor packages #https://cran.r-project.org/web/packages/BiocManager/vignettes/BiocManager.html if (!requireNamespace(&quot;BiocManager&quot;, quietly = TRUE)) install.packages(&quot;BiocManager&quot;) requiredPackages = c(&#39;edgeR&#39;,&#39;DESeq2&#39;,&#39;vsn&#39;,&#39;org.Hs.eg.db&#39;, &quot;knitr&quot;) for (p in requiredPackages) { if(p %in% rownames(installed.packages()) == FALSE) {BiocManager::install(p)} } ## CRAN packages requiredPackages = c(&#39;ggplot2&#39;,&#39;dplyr&#39;,&#39;NMF&#39;,&#39;grDevices&#39;, &quot;hexbin&quot;, &quot;statmod&quot;, &quot;reshape2&quot;) for (p in requiredPackages) { if(p %in% rownames(installed.packages()) == FALSE) {install.packages(p)} } The following R packages are required for the data analysis. # Base library(R.utils) library(knitr) library(tidyverse) library(devtools) library(tinytable) library(rairtable) library(janitor) library(broom) library(ggtext) library(tibble) library(stringr) library(dplyr) library(DESeq2) library(edgeR) library(ggplot2) library(vsn) library(NMF) library(org.Hs.eg.db) library(grDevices) library(hexbin) library(statmod) library(reshape2) library(pheatmap) library(tibble) library(vegan) University of Copenhagen, antton.alberdi@sund.ku.dk↩︎ "],["prepare-data.html", "Chapter 2 Prepare data 2.1 Bioinformatics 2.2 Load data 2.3 Prepare data", " Chapter 2 Prepare data 2.1 Bioinformatics 2.1.1 Get data mkdir genome wget -P genome https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/009/045/GCF_000009045.1_ASM904v1/GCF_000009045.1_ASM904v1_genomic.fna.gz mkdir reads # fetch data from ERDA 2.1.2 Run annotation and profiling drakkar annotating -b genome drakkar expressing -b genome -r reads 2.1.3 Experimental design This project consists of 40 RNAseq samples. Twenty samples were collected at 3 h and the remaining 20 at 24 h. The experiment includes one control group (C) and three treatment groups, in which bacteria were exposed to 5 mg/mL of the following minerals: goethite (G), hematite (H) and mica (M). Each condition includes 4 biological replicates for which RNA was extracted using the ZymoBIOMICS RNA Kit, and one replicate for which RNA was extracted using the DREX protocol. Experimental design 2.1.4 Get working files gene_annotations.tsv.xz gene_counts.tsv.xz 2.2 Load data Samples have been split in different lanes during sequencing so gene_counts.tsv.xz has more columns that what is expected for the conditions of the experiments (40 different samples). read_counts &lt;- read_tsv( &quot;data/gene_counts.tsv.xz&quot;, comment = &quot;#&quot;, # skip featureCounts metadata col_names = TRUE, # header is present show_col_types = FALSE # silence messages ) %&gt;% dplyr::rename(gene = Geneid) %&gt;% pivot_longer(!c(gene,Chr,Start,End,Strand,Length),names_to=&quot;library&quot;,values_to = &quot;counts&quot;) %&gt;% mutate(sample = str_extract(library, &quot;^[^_]+&quot;)) %&gt;% group_by(gene,Chr,Start,End,Strand,Length,sample) %&gt;% summarise(counts=sum(counts)) %&gt;% pivot_wider(c(gene,Chr,Start,End,Strand,Length), names_from = &quot;sample&quot;, values_from = &quot;counts&quot;) gene_annotations &lt;- read_tsv(&quot;data/gene_annotations.tsv.xz&quot;) %&gt;% dplyr::rename(gene=1) sample_metadata &lt;- read_csv(&quot;data/sample_metadata.csv&quot;) sample_metadata &lt;- sample_metadata %&gt;% mutate(timepoint = str_extract(`Sample ID`, &quot;\\\\d+$&quot;), mineral_code = substr(`Sample ID`, 3, 3)) 2.3 Prepare data Preliminary processing of the data to prepare it for visualizations read_counts &lt;- read_counts %&gt;% pivot_longer(!c(gene,Chr,Start,End,Strand,Length),names_to=&quot;sample&quot;,values_to = &quot;counts&quot;) %&gt;% inner_join(sample_metadata, by=&quot;sample&quot;) %&gt;% mutate(ID = paste(`Sample ID`, str_sub(Extraction, 1, 1), sep = &quot;_&quot;)) %&gt;% dplyr::select(gene, ID, counts) %&gt;% pivot_wider(c(gene), names_from = &quot;ID&quot;, values_from = &quot;counts&quot;) %&gt;% column_to_rownames(var = &quot;gene&quot;) sample_metadata &lt;- sample_metadata %&gt;% mutate(ID = paste(`Sample ID`, str_sub(Extraction, 1, 1), sep = &quot;_&quot;)) %&gt;% column_to_rownames(var = &quot;ID&quot;) "],["preliminary-visualizations.html", "Chapter 3 Preliminary visualizations 3.1 Filtering and normalization 3.2 Preliminary visualizations 3.3 Preliminary visualizations wo DREX group 3.4 Other PCAs", " Chapter 3 Preliminary visualizations 3.1 Filtering and normalization # Create edgeR DGEList dge &lt;- DGEList(counts = read_counts) # Filter lowly expressed genes (keep genes with CPM&gt;1 in at least 2 samples) keep &lt;- rowSums(cpm(dge) &gt; 1) &gt;= 2 dge &lt;- dge[keep, , keep.lib.sizes = FALSE] # Normalize for library size (TMM normalization) dge &lt;- calcNormFactors(dge) # Log2 CPM transformation logCPM &lt;- cpm(dge, log = TRUE, prior.count = 1) # log2(CPM + 1) 3.2 Preliminary visualizations 3.2.1 Library size plot In this plot we see a fold difference of 3-4X between the samples with the lowest number of reads and the samples with the highest number of reads. Most of the difference is between the 3 h samples (higher expression, exponential growth curve) and 24 h samples (lower expression, stationary phase). At 24 h DREX protocol seems yield more RNA than most of Zymo samples. Goethite samples at 3 h -(except DREX sample) have less reads than the rest of 3 h samples, which agrees with the concentrations calculated with Qubit. We expect some cell death in goethite at 3 h. # Total reads per sample (wihtout filtering and normalizing) lib_sizes &lt;- colSums(read_counts) par(mgp = c(3.4, 1, 0)) barplot(lib_sizes, las = 2, cex.axis = 0.7, ylab = &quot;Total reads&quot;, main = &quot;Library sizes per sample&quot;) 3.2.2 Box plots of transformed counts Most of the samples processed with DREX protocol show narrower distributions (reads are more evenly distributed across genes), is this good or bad? boxplot(logCPM, las = 2, outline = FALSE, ylab = &quot;log2 CPM&quot;, main = &quot;Distribution of log2-CPM per sample&quot;) 3.2.3 Hierarchical clustering The clustering separates each mineral sample quite good at 3 h, but not that good at 24 h (except for goethite) distance_mat &lt;- as.dist(1 - cor(logCPM)) # Pearson correlation distance hclust_res &lt;- hclust(distance_mat) plot(hclust_res, labels = colnames(logCPM), main = &quot;Hierarchical Clustering (log2 CPM)&quot;) 3.2.4 Sample-sample distance heatmap Distance calculation is the same as the previous one but here with all the metadata and pairwise distances visible heatmap_metadata &lt;- sample_metadata %&gt;% dplyr::select(`Qubit conc ng/uL`, Extraction, timepoint, mineral_code) sample_dist &lt;- as.dist(1 - cor(logCPM, method = &quot;pearson&quot;)) pheatmap(as.matrix(sample_dist), annotation_col = heatmap_metadata, main = &quot;Sample–sample distance heatmap&quot;) 3.2.5 PCA In the PCA there are some interesting observations: The first PC explains most of the variance in the samples and it clearly separates the samples at 3 h and 24 h for all the minerals and RNA extraction protocols. PC2 captures some of the variance between samples processed with DREX at 24 h. It seems for samples at 3 h the extraction protocol did not have that effect. PC2 and especially PC3 caputres some of the variance that differentiates the goethite samples at 3 h (maybe stress response?) pca_res &lt;- prcomp(t(logCPM)) # samples as rows pca_scores &lt;- as.data.frame(pca_res$x) %&gt;% tibble::rownames_to_column(&quot;sample_pca&quot;) pca_metadata &lt;- sample_metadata %&gt;% tibble::rownames_to_column(&quot;sample_pca&quot;) pca_df &lt;- pca_scores %&gt;% dplyr::left_join(pca_metadata, by = &quot;sample_pca&quot;) # Calculate percent of variance explained # Variance explained per PC pca_var &lt;- pca_res$sdev^2 pca_var_frac &lt;- pca_var / sum(pca_var) # Percent variance explained pca_var_pct &lt;- round(100 * pca_var_frac, 1) ggplot(pca_df, aes(x = PC1, y = PC2, color = mineral_code, shape = timepoint)) + geom_point(size = 3) + geom_text(aes(label = sample_pca), vjust = -0.7, size = 3) + theme_bw() + labs( title = &quot;PCA of log2-CPM counts&quot;, x = paste0(&quot;PC1 (&quot;, pca_var_pct[1], &quot;%)&quot;), y = paste0(&quot;PC2 (&quot;, pca_var_pct[2], &quot;%)&quot;) ) ggplot(pca_df, aes(x = PC1, y = PC3, color = mineral_code, shape = timepoint)) + geom_point(size = 3) + geom_text(aes(label = sample_pca), vjust = -0.7, size = 3) + theme_bw() + labs( title = &quot;PCA of log2-CPM counts&quot;, x = paste0(&quot;PC1 (&quot;, pca_var_pct[1], &quot;%)&quot;), y = paste0(&quot;PC3 (&quot;, pca_var_pct[3], &quot;%)&quot;) ) ggplot(pca_df, aes(x = PC2, y = PC3, color = mineral_code, shape = timepoint)) + geom_point(size = 3) + geom_text(aes(label = sample_pca), vjust = -0.7, size = 3) + theme_bw() + labs( title = &quot;PCA of log2-CPM counts&quot;, x = paste0(&quot;PC2 (&quot;, pca_var_pct[2], &quot;%)&quot;), y = paste0(&quot;PC3 (&quot;, pca_var_pct[3], &quot;%)&quot;) ) pca_var_df &lt;- data.frame( PC = factor(paste0(&quot;PC&quot;, seq_along(pca_var_pct)), levels = paste0(&quot;PC&quot;, seq_along(pca_var_pct))), variance = pca_var_pct ) ggplot(pca_var_df[1:15, ], aes(x = PC, y = variance)) + geom_col(fill = &quot;steelblue&quot;) + geom_line(aes(group = 1)) + geom_point() + theme_bw() + labs( title = &quot;Variance explained by principal components&quot;, y = &quot;Variance explained (%)&quot;, x = &quot;&quot; ) pca_var_df$cumulative &lt;- cumsum(pca_var_df$variance) ggplot(pca_var_df[1:20, ], aes(x = PC, y = cumulative)) + geom_line(group = 1) + geom_point() + theme_bw() + labs( title = &quot;Cumulative variance explained&quot;, y = &quot;Cumulative variance (%)&quot;, x = &quot;&quot; ) 3.2.6 PERMANOVA and dispersion test Here we do PERMANOVA using the option “terms” that adds predictors one at a time, in order, and seeing how much extra variation each of them adds. y ~ timepoint * mineral is the same as y ~ timepoint + mineral + timepoint:mineral # Distance matrix dist_mat &lt;- as.dist(1 - cor(logCPM, method = &quot;pearson&quot;)) # by = &quot;terms&quot; means adonis2 tests terms in order, like Type I sums of squares in ANOVA. The differences between terms and margin are not very important when you have balanced samples like we have here. # Permanova perm_res &lt;- adonis2( dist_mat ~ timepoint * mineral_code, data = sample_metadata, permutations = 999, by = &quot;terms&quot; ) # Nice table perm_table &lt;- as.data.frame(perm_res) %&gt;% rownames_to_column(&quot;term&quot;) perm_table term Df SumOfSqs R2 F Pr(&gt;F) 1 timepoint 1 0.02513269 0.02978503 2.150078 0.125 2 mineral_code 3 0.10287832 0.12192225 2.933714 0.021 3 timepoint:mineral_code 3 0.34173725 0.40499666 9.745100 0.001 4 Residual 32 0.37405438 0.44329605 NA NA 5 Total 39 0.84380264 1.00000000 NA NA The PERMANOVA on sample–sample expression distances reveals a significant effect of the mineral (R² = 0.12, p = 0.014) and a strong timepoint × mineral interaction (R² = 0.41, p = 0.001), while the main effect of timepoint alone was not significant (R² = 0.03, p = 0.119). The timepoint not being significant means that the 3h and 24h variation is different for different minerals? They were clearly separated in the PCA. Does it mean that is important but only when accounting for the interaction (considering the R2)? Conclusion of the permanova is that it suggests mineral-associated transcriptional responses differ substantially between 3h and 24h. # Create combined group factor: timepoint:mineral sample_metadata &lt;- sample_metadata %&gt;% mutate(group = interaction(timepoint, mineral_code, drop = TRUE)) bd_group &lt;- betadisper(dist_mat, sample_metadata$group) disp_group &lt;- anova(bd_group) bd_time &lt;- betadisper(dist_mat, sample_metadata$timepoint) bd_mineral &lt;- betadisper(dist_mat, sample_metadata$mineral_code) disp_time &lt;- anova(bd_time) disp_mineral &lt;- anova(bd_mineral) disp_table &lt;- bind_rows( data.frame(test = &quot;Dispersion: timepoint&quot;, F = disp_time$`F value`[1], p = disp_time$`Pr(&gt;F)`[1]), data.frame(test = &quot;Dispersion: mineral&quot;, F = disp_mineral$`F value`[1], p = disp_mineral$`Pr(&gt;F)`[1]), data.frame(test = &quot;Dispersion: timepoint:mineral&quot;, F = disp_group$`F value`[1], p = disp_group$`Pr(&gt;F)`[1]) ) %&gt;% mutate( F = round(F, 3), p = signif(p, 3) ) disp_table test F p 1 Dispersion: timepoint 2.373 0.132 2 Dispersion: mineral 0.565 0.642 3 Dispersion: timepoint:mineral 1.290 0.287 final_table &lt;- perm_table %&gt;% dplyr::select(term, Df, F, R2, `Pr(&gt;F)`) %&gt;% dplyr::rename(p = `Pr(&gt;F)`) final_table term Df F R2 p 1 timepoint 1 2.150078 0.02978503 0.125 2 mineral_code 3 2.933714 0.12192225 0.021 3 timepoint:mineral_code 3 9.745100 0.40499666 0.001 4 Residual 32 NA 0.44329605 NA 5 Total 39 NA 1.00000000 NA plot(bd_group) boxplot(bd_group) The 8 timepoint*mieneral groups do NOT differ significantly in their spread, so the permanova interaction is not likely an artifact of dispersion differences. 3h and 24h have similar within group variability and minerals do not differ in dispersion either. This means that we can trust the PERMANOVA. 3.3 Preliminary visualizations wo DREX group We plot some of the same visualizations after removing the DREX samples. 3.3.1 Filtering DREX group, filtering and normalization # Filter out samples processed using DREX protocol read_counts_f &lt;- read_counts %&gt;% dplyr::select(-ends_with(&quot;D&quot;)) # Create edgeR DGEList dge &lt;- DGEList(counts = read_counts_f) # Filter lowly expressed genes (keep genes with CPM&gt;1 in at least 2 samples) keep &lt;- rowSums(cpm(dge) &gt; 1) &gt;= 2 dge &lt;- dge[keep, , keep.lib.sizes = FALSE] # Normalize for library size (TMM normalization) dge &lt;- calcNormFactors(dge) # Log2 CPM transformation logCPM &lt;- cpm(dge, log = TRUE, prior.count = 1) # log2(CPM + 1) 3.3.2 Hierarchical clustering distance_mat &lt;- as.dist(1 - cor(logCPM)) # Pearson correlation distance hclust_res &lt;- hclust(distance_mat) plot(hclust_res, labels = colnames(logCPM), main = &quot;Hierarchical Clustering (log2 CPM)&quot;) 3.3.3 Sample-sample distance heatmap heatmap_metadata &lt;- sample_metadata %&gt;% dplyr::select(`Qubit conc ng/uL`, Extraction, timepoint, mineral_code) sample_dist &lt;- as.dist(1 - cor(logCPM, method = &quot;pearson&quot;)) pheatmap(as.matrix(sample_dist), annotation_col = heatmap_metadata, main = &quot;Sample–sample distance heatmap&quot;) 3.3.4 PCA Observations after removing the DREX samples: PC1 keeps capturing the variance related to the timepoint of sample collection. PC2 clearly separates the goetihte smaples at 3 h and a little bit at 24 h, some of the expression pattern in goethite is quite different at the beginning and the difference start fading after 24 h. PC3 separates the goethite samples at 24 h but not at 3 h. PC4 separates the controls at 24 h pca_res &lt;- prcomp(t(logCPM)) # samples as rows pca_scores &lt;- as.data.frame(pca_res$x) %&gt;% tibble::rownames_to_column(&quot;sample_pca&quot;) pca_metadata &lt;- sample_metadata %&gt;% tibble::rownames_to_column(&quot;sample_pca&quot;) pca_df &lt;- pca_scores %&gt;% dplyr::left_join(pca_metadata, by = &quot;sample_pca&quot;) # Calculate percent of variance explained # Variance explained per PC pca_var &lt;- pca_res$sdev^2 pca_var_frac &lt;- pca_var / sum(pca_var) # Percent variance explained pca_var_pct &lt;- round(100 * pca_var_frac, 1) ggplot(pca_df, aes(x = PC1, y = PC2, color = mineral_code, shape = timepoint)) + geom_point(size = 3) + geom_text(aes(label = sample_pca), vjust = -0.7, size = 3) + theme_bw() + labs( title = &quot;PCA of log2-CPM counts&quot;, x = paste0(&quot;PC1 (&quot;, pca_var_pct[1], &quot;%)&quot;), y = paste0(&quot;PC2 (&quot;, pca_var_pct[2], &quot;%)&quot;) ) ggplot(pca_df, aes(x = PC1, y = PC3, color = mineral_code, shape = timepoint)) + geom_point(size = 3) + geom_text(aes(label = sample_pca), vjust = -0.7, size = 3) + theme_bw() + labs( title = &quot;PCA of log2-CPM counts&quot;, x = paste0(&quot;PC1 (&quot;, pca_var_pct[1], &quot;%)&quot;), y = paste0(&quot;PC3 (&quot;, pca_var_pct[3], &quot;%)&quot;) ) ggplot(pca_df, aes(x = PC2, y = PC3, color = mineral_code, shape = timepoint)) + geom_point(size = 3) + geom_text(aes(label = sample_pca), vjust = -0.7, size = 3) + theme_bw() + labs( title = &quot;PCA of log2-CPM counts&quot;, x = paste0(&quot;PC2 (&quot;, pca_var_pct[2], &quot;%)&quot;), y = paste0(&quot;PC3 (&quot;, pca_var_pct[3], &quot;%)&quot;) ) ggplot(pca_df, aes(x = PC3, y = PC4, color = mineral_code, shape = timepoint)) + geom_point(size = 3) + geom_text(aes(label = sample_pca), vjust = -0.7, size = 3) + theme_bw() + labs( title = &quot;PCA of log2-CPM counts&quot;, x = paste0(&quot;PC3 (&quot;, pca_var_pct[3], &quot;%)&quot;), y = paste0(&quot;PC4 (&quot;, pca_var_pct[4], &quot;%)&quot;) ) pca_var_df &lt;- data.frame( PC = factor(paste0(&quot;PC&quot;, seq_along(pca_var_pct)), levels = paste0(&quot;PC&quot;, seq_along(pca_var_pct))), variance = pca_var_pct ) ggplot(pca_var_df[1:15, ], aes(x = PC, y = variance)) + geom_col(fill = &quot;steelblue&quot;) + geom_line(aes(group = 1)) + geom_point() + theme_bw() + labs( title = &quot;Variance explained by principal components&quot;, y = &quot;Variance explained (%)&quot;, x = &quot;&quot; ) pca_var_df$cumulative &lt;- cumsum(pca_var_df$variance) ggplot(pca_var_df[1:20, ], aes(x = PC, y = cumulative)) + geom_line(group = 1) + geom_point() + theme_bw() + labs( title = &quot;Cumulative variance explained&quot;, y = &quot;Cumulative variance (%)&quot;, x = &quot;&quot; ) 3.3.5 PERMANOVA and dispersion test # Filter metadata so adonis2 is happy sample_metadata_f &lt;- sample_metadata %&gt;% dplyr::filter(Extraction == &quot;Zymo&quot;) # Create edgeR DGEList dge &lt;- DGEList(counts = read_counts_f) # Filter lowly expressed genes (keep genes with CPM&gt;1 in at least 2 samples) keep &lt;- rowSums(cpm(dge) &gt; 1) &gt;= 2 dge &lt;- dge[keep, , keep.lib.sizes = FALSE] # Normalize for library size (TMM normalization) dge &lt;- calcNormFactors(dge) # Log2 CPM transformation logCPM &lt;- cpm(dge, log = TRUE, prior.count = 1) # log2(CPM + 1) # Distance matrix dist_mat &lt;- as.dist(1 - cor(logCPM, method = &quot;pearson&quot;)) # by = &quot;terms&quot; means adonis2 tests terms in order, like Type I sums of squares in ANOVA # Permanova perm_res &lt;- adonis2( dist_mat ~ timepoint * mineral_code, data = sample_metadata_f, permutations = 999, by = &quot;terms&quot; ) # Nice table perm_table &lt;- as.data.frame(perm_res) %&gt;% rownames_to_column(&quot;term&quot;) perm_table term Df SumOfSqs R2 F Pr(&gt;F) 1 timepoint 1 0.01698805 0.03018055 1.847105 0.163 2 mineral_code 3 0.07690089 0.13662020 2.787136 0.036 3 timepoint:mineral_code 3 0.24826094 0.44105418 8.997776 0.001 4 Residual 24 0.22073094 0.39214507 NA NA 5 Total 31 0.56288083 1.00000000 NA NA Here we get similar results as when including the DREX samples. The tiempoint by itself does not show an effect in the PERMANOVA (R² = 0.03, p = 0.156), we observe effect from the mineral when considering alredy timepoint in the model (R² = 0.14, p = 0.031) and again a strong timepoint × mineral interaction (R² = 0.44, p = 0.001). # Create combined group factor: timepoint:mineral sample_metadata_f &lt;- sample_metadata_f %&gt;% mutate(group = interaction(timepoint, mineral_code, drop = TRUE)) bd_group &lt;- betadisper(dist_mat, sample_metadata_f$group) disp_group &lt;- anova(bd_group) bd_time &lt;- betadisper(dist_mat, sample_metadata_f$timepoint) bd_mineral &lt;- betadisper(dist_mat, sample_metadata_f$mineral_code) disp_time &lt;- anova(bd_time) disp_mineral &lt;- anova(bd_mineral) disp_table &lt;- bind_rows( data.frame(test = &quot;Dispersion: timepoint&quot;, F = disp_time$`F value`[1], p = disp_time$`Pr(&gt;F)`[1]), data.frame(test = &quot;Dispersion: mineral&quot;, F = disp_mineral$`F value`[1], p = disp_mineral$`Pr(&gt;F)`[1]), data.frame(test = &quot;Dispersion: timepoint:mineral&quot;, F = disp_group$`F value`[1], p = disp_group$`Pr(&gt;F)`[1]) ) %&gt;% mutate( F = round(F, 3), p = signif(p, 3) ) disp_table test F p 1 Dispersion: timepoint 1.123 0.298 2 Dispersion: mineral 0.345 0.793 3 Dispersion: timepoint:mineral 1.535 0.203 final_table &lt;- perm_table %&gt;% dplyr::select(term, Df, F, R2, `Pr(&gt;F)`) %&gt;% dplyr::rename(p = `Pr(&gt;F)`) final_table term Df F R2 p 1 timepoint 1 1.847105 0.03018055 0.163 2 mineral_code 3 2.787136 0.13662020 0.036 3 timepoint:mineral_code 3 8.997776 0.44105418 0.001 4 Residual 24 NA 0.39214507 NA 5 Total 31 NA 1.00000000 NA plot(bd_group) boxplot(bd_group) Dispersion also remained being not significant and so again the PERMANOVA interaction is not likely an artifact of dispersion differences. In the boxplot we see that after removing the DREX group the variations within groups decreased a little bit. 3.4 Other PCAs 3.4.1 Samples at 3h Here we check PCAs information by subsetting the data in different groups. First we look at PCA of samples at 3h. At 3h most of the variation separates goethite from the rest of the samples (PC1). PC2 separates some of the minerals, but not completely. The PC3 separates the minerals quite well, especially mica and the control. It keeps goethite and hematite together. This is interesting because these two are both iron oxides and there might be some biological meaning behind this. # Filter out samples processed using DREX protocol read_counts_3h &lt;- read_counts %&gt;% dplyr::select(-ends_with(&quot;D&quot;)) %&gt;% dplyr::select((matches(&quot;3_&quot;))) # Create edgeR DGEList dge &lt;- DGEList(counts = read_counts_3h) # Filter lowly expressed genes (keep genes with CPM&gt;1 in at least 2 samples) keep &lt;- rowSums(cpm(dge) &gt; 1) &gt;= 2 dge &lt;- dge[keep, , keep.lib.sizes = FALSE] # Normalize for library size (TMM normalization) dge &lt;- calcNormFactors(dge) # Log2 CPM transformation logCPM &lt;- cpm(dge, log = TRUE, prior.count = 1) # log2(CPM + 1) pca_res &lt;- prcomp(t(logCPM)) # samples as rows pca_scores &lt;- as.data.frame(pca_res$x) %&gt;% tibble::rownames_to_column(&quot;sample_pca&quot;) pca_metadata &lt;- sample_metadata %&gt;% tibble::rownames_to_column(&quot;sample_pca&quot;) pca_df &lt;- pca_scores %&gt;% dplyr::left_join(pca_metadata, by = &quot;sample_pca&quot;) # Calculate percent of variance explained # Variance explained per PC pca_var &lt;- pca_res$sdev^2 pca_var_frac &lt;- pca_var / sum(pca_var) # Percent variance explained pca_var_pct &lt;- round(100 * pca_var_frac, 1) ggplot(pca_df, aes(x = PC1, y = PC2, color = mineral_code, shape = timepoint)) + geom_point(size = 3) + geom_text(aes(label = sample_pca), vjust = -0.7, size = 3) + theme_bw() + labs( title = &quot;PCA of log2-CPM counts&quot;, x = paste0(&quot;PC1 (&quot;, pca_var_pct[1], &quot;%)&quot;), y = paste0(&quot;PC2 (&quot;, pca_var_pct[2], &quot;%)&quot;) ) ggplot(pca_df, aes(x = PC1, y = PC3, color = mineral_code, shape = timepoint)) + geom_point(size = 3) + geom_text(aes(label = sample_pca), vjust = -0.7, size = 3) + theme_bw() + labs( title = &quot;PCA of log2-CPM counts&quot;, x = paste0(&quot;PC1 (&quot;, pca_var_pct[1], &quot;%)&quot;), y = paste0(&quot;PC3 (&quot;, pca_var_pct[3], &quot;%)&quot;) ) ggplot(pca_df, aes(x = PC2, y = PC3, color = mineral_code, shape = timepoint)) + geom_point(size = 3) + geom_text(aes(label = sample_pca), vjust = -0.7, size = 3) + theme_bw() + labs( title = &quot;PCA of log2-CPM counts&quot;, x = paste0(&quot;PC2 (&quot;, pca_var_pct[2], &quot;%)&quot;), y = paste0(&quot;PC3 (&quot;, pca_var_pct[3], &quot;%)&quot;) ) ggplot(pca_df, aes(x = PC3, y = PC4, color = mineral_code, shape = timepoint)) + geom_point(size = 3) + geom_text(aes(label = sample_pca), vjust = -0.7, size = 3) + theme_bw() + labs( title = &quot;PCA of log2-CPM counts&quot;, x = paste0(&quot;PC3 (&quot;, pca_var_pct[3], &quot;%)&quot;), y = paste0(&quot;PC4 (&quot;, pca_var_pct[4], &quot;%)&quot;) ) 3.4.2 Samples at 24h Here we see again that PC1 separates the goethite samples from the rest and that has most of the variation. Here we dont get as clear samples’s clusters as we did for 3h. Might suggest that 24h samples are more similar than the 3h samples. # Filter out samples processed using DREX protocol read_counts_24h &lt;- read_counts %&gt;% dplyr::select(-ends_with(&quot;D&quot;)) %&gt;% dplyr::select((matches(&quot;24_&quot;))) # Create edgeR DGEList dge &lt;- DGEList(counts = read_counts_24h) # Filter lowly expressed genes (keep genes with CPM&gt;1 in at least 2 samples) keep &lt;- rowSums(cpm(dge) &gt; 1) &gt;= 2 dge &lt;- dge[keep, , keep.lib.sizes = FALSE] # Normalize for library size (TMM normalization) dge &lt;- calcNormFactors(dge) # Log2 CPM transformation logCPM &lt;- cpm(dge, log = TRUE, prior.count = 1) # log2(CPM + 1) pca_res &lt;- prcomp(t(logCPM)) # samples as rows pca_scores &lt;- as.data.frame(pca_res$x) %&gt;% tibble::rownames_to_column(&quot;sample_pca&quot;) pca_metadata &lt;- sample_metadata %&gt;% tibble::rownames_to_column(&quot;sample_pca&quot;) pca_df &lt;- pca_scores %&gt;% dplyr::left_join(pca_metadata, by = &quot;sample_pca&quot;) # Calculate percent of variance explained # Variance explained per PC pca_var &lt;- pca_res$sdev^2 pca_var_frac &lt;- pca_var / sum(pca_var) # Percent variance explained pca_var_pct &lt;- round(100 * pca_var_frac, 1) ggplot(pca_df, aes(x = PC1, y = PC2, color = mineral_code, shape = timepoint)) + geom_point(size = 3) + geom_text(aes(label = sample_pca), vjust = -0.7, size = 3) + theme_bw() + labs( title = &quot;PCA of log2-CPM counts&quot;, x = paste0(&quot;PC1 (&quot;, pca_var_pct[1], &quot;%)&quot;), y = paste0(&quot;PC2 (&quot;, pca_var_pct[2], &quot;%)&quot;) ) ggplot(pca_df, aes(x = PC1, y = PC3, color = mineral_code, shape = timepoint)) + geom_point(size = 3) + geom_text(aes(label = sample_pca), vjust = -0.7, size = 3) + theme_bw() + labs( title = &quot;PCA of log2-CPM counts&quot;, x = paste0(&quot;PC1 (&quot;, pca_var_pct[1], &quot;%)&quot;), y = paste0(&quot;PC3 (&quot;, pca_var_pct[3], &quot;%)&quot;) ) ggplot(pca_df, aes(x = PC2, y = PC3, color = mineral_code, shape = timepoint)) + geom_point(size = 3) + geom_text(aes(label = sample_pca), vjust = -0.7, size = 3) + theme_bw() + labs( title = &quot;PCA of log2-CPM counts&quot;, x = paste0(&quot;PC2 (&quot;, pca_var_pct[2], &quot;%)&quot;), y = paste0(&quot;PC3 (&quot;, pca_var_pct[3], &quot;%)&quot;) ) ggplot(pca_df, aes(x = PC3, y = PC4, color = mineral_code, shape = timepoint)) + geom_point(size = 3) + geom_text(aes(label = sample_pca), vjust = -0.7, size = 3) + theme_bw() + labs( title = &quot;PCA of log2-CPM counts&quot;, x = paste0(&quot;PC3 (&quot;, pca_var_pct[3], &quot;%)&quot;), y = paste0(&quot;PC4 (&quot;, pca_var_pct[4], &quot;%)&quot;) ) 3.4.3 Next ideas "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
